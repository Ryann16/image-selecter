/*!
 * VERSION: 0.1.0
 * DATE: 2015-09-24
 * GIT:https://github.com/shrekshrek/image-uploader
 *
 * @author: Shrek.wang, shrekshrek@gmail.com
 **/

!function(t){var e="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;if("function"==typeof define&&define.amd)define(["exif","exports"],function(a,n){e.ImgSlter=t(e,n,a)});else if("undefined"!=typeof exports){var a=require("exif");t(e,exports,a)}else e.ImgSlter=t(e,{},e.EXIF)}(function(t,e,a){function n(){var t=navigator.userAgent;return{ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),iosv:t.substr(t.indexOf("iPhone OS")+9,3)}}function i(t,e){for(var a in e)t[a]=e[a]}function c(t){if(!t)throw"target is undefined, can't tween!!!";return"string"==typeof t?"undefined"==typeof document?t:document.querySelectorAll?document.querySelectorAll(t):document.getElementById("#"===t.charAt(0)?t.substr(1):t):t}return e=function(){this.init.apply(this,arguments)},i(e.prototype,{init:function(t){var e=this,a=t||{};this.el=a.el?c(a.el)[0]:function(){var t=document.createElement("INPUT");return t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.setAttribute("capture","camera"),t}(),this.size=a.size||500,this.type=a.type||"jpeg",this.quality=a.quality||.7,this.ua=n(),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.changeHandler=function(t){e.change(t)},this.el.addEventListener("change",this.changeHandler,!1),this.handler=null},change:function(t){var e=this,n=t.target.files[0];if(void 0!=n){var i,c,s,r,l,h;window.URL=window.URL||window.webkitURL;var o=window.URL.createObjectURL(n),d=new Image;d.src=o,d.onload=function(){a.getData(d,function(){var t=a.getTag(this,"Orientation")||0;switch(i=d.width,r=d.height,i>=r?(c=e.size,l=c*r/i,s=i,h=r):(l=e.size,c=l*i/r,s=r,h=i),t){case 3:e.canvas.width=c,e.canvas.height=l,e.ctx.clearRect(0,0,c,l),e.ctx.translate(c/2,l/2),e.ctx.rotate(180*Math.PI/180);break;case 6:e.canvas.width=l,e.canvas.height=c,e.ctx.clearRect(0,0,l,c),e.ctx.translate(l/2,c/2),e.ctx.rotate(90*Math.PI/180);break;case 8:e.canvas.width=l,e.canvas.height=c,e.ctx.clearRect(0,0,l,c),e.ctx.translate(l/2,c/2),e.ctx.rotate(270*Math.PI/180);break;default:e.canvas.width=c,e.canvas.height=l,e.ctx.clearRect(0,0,c,l),e.ctx.translate(c/2,l/2)}s>3260||h>2440?e.ua.ios?8==parseInt(e.ua.iosv)?e.ctx.drawImage(d,0,0,i,r,-c/2,-l/2,c,l):e.ctx.drawImage(d,0,0,i/2,r/2,-c/2,-l/2,c,l):e.ctx.drawImage(d,0,0,i,r,-c/2,-l/2,c,l):e.ctx.drawImage(d,-c/2,-l/2,c,l),e.handler&&e.handler.call(this,{img:e.canvas.toDataURL("image/"+e.type,e.quality),width:e.canvas.width,height:e.canvas.height})})}}},select:function(){this.el&&this.el.click()},destroy:function(){this.el.removeEventListener("change",this.changeHandler,!1),delete this.ua,delete this.ctx,delete this.canvas,delete this.el}}),e});
